@startuml Flujo Frontend - Optimización de Rutas

title Diagrama de Flujo - Frontend del Sistema de Optimización de Rutas

start
:Usuario abre la aplicación;

:Sistema carga rutas disponibles;

:Usuario ve lista de rutas;

if (¿Selecciona una ruta?) then (Sí)
  
  :Usuario selecciona ruta
  del dropdown;
  
  :Sistema muestra información
  de la ruta (nombre, paradas);

  :Usuario selecciona Parada Inicial y Parada Final;
  note right
    Opcional: el usuario puede escoger
    manualmente la parada de inicio y
    la parada final para el recorrido.
  end note

  :Usuario ajusta parámetros del
  Algoritmo Genético (GA):
  • Tamaño población
  • Número de generaciones
  • Tasa de mutación;
  note right
    El panel de parámetros permite afinar
    la búsqueda antes de ejecutar la optimización.
  end note

  :Usuario hace clic en
  "Optimizar Ruta";
  
  :Sistema muestra estado
  "Cargando...";
  
  :Sistema envía petición
  al backend con ID de ruta;
  
  :Sistema muestra animación
  de carga en mapa;
  
  note right
    **El backend procesa:**
    • Geocodificación
    • Matriz de distancias
    • Algoritmo genético
    • ~30-60 segundos
  end note
  
  if (¿Respuesta exitosa?) then (Sí)
    
    :Sistema recibe rutas
    optimizadas + estadísticas;
    
    :Sistema actualiza estado
    React (rutasOptimizadas);
    
    :Sistema renderiza componentes;
    
    :MapView: Mostrar mapa Leaflet,
    Dibujar Polyline (geometría),
    Colocar Markers (paradas);
    
    :GeneticAlgorithmPanel: Mostrar distancia total,
    número de paradas, parámetros GA;
    
    :AlgorithmProcedurePanel: Mostrar procedimiento,
    paradas ordenadas, horarios;
    
    :Usuario ve resultados en el mapa;
    
    :Usuario ve ruta optimizada
    (línea siguiendo calles);
    
    :Usuario ve paradas ordenadas
    con marcadores;
    
    :Usuario ve estadísticas:
    Distancia total (km),
    Número de paradas,
    Orden optimizado;
    
    :Usuario puede hacer clic en "Animar Recorrido";
    if (¿Animar Recorrido?) then (Sí)
      :MapView inicia animación de ruta;
      note right
        La animación dibuja un Polyline destacado
        que avanza a lo largo de la geometría (sin
        necesidad de un ícono de bus); la duración
        por defecto es ~15s (escalable por velocidad).
      end note

      :Usuario puede controlar (Play/Pause/Stop/Speed)
      desde el panel de animación;
    else (No)
      :Usuario no reproduce animación;
    endif

    :Usuario puede hacer clic en "Analizar con IA";
    if (¿Analizar con IA?) then (Sí)
      :Sistema empaqueta resultados + parámetros y
      envía petición al servicio AI (Gemini);
      note right
        Prompt incluye: resultados de optimización,
        parámetros GA usados, métricas y restricciones.
      end note

      :Sistema muestra modal con análisis
      generado por la IA (explicación, recomendaciones,
      sugerencias de parámetros);
      note right
        El modal contiene: resumen, listado de mejoras,
        y acciones sugeridas (ajustar parámetros, re-ejecutar).
      end note

      :Usuario lee el análisis y cierra el modal;
    else (No)
      :Usuario omite el análisis con IA;
    endif

    :Usuario revisa panel
    de procedimiento;
    
    if (¿Optimizar otra ruta?) then (Sí)
      :Usuario selecciona nueva ruta;
      stop
    else (No)
      :Usuario analiza resultados;
      stop
    endif
    
  else (Error)
    :Sistema muestra notificación de error;
    
    :Sistema mantiene última vista válida;
    
    if (¿Usuario reintenta?) then (Sí)
      stop
    else (No)
      stop
    endif
  endif
  
else (No)
  :Usuario ve mensaje
  "Selecciona una Ruta";
  
  :Usuario ve mapa vacío
  centrado en Villavicencio;
  
  stop
endif

@enduml
